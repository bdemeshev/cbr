---
lang: russian
title: "Введение в пакет cbr"
author: "Артем Симакин"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Введение в пакет cbr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Данные, предоставленные Центральным Банком РФ

ЦБ РФ предоставляет [возможность](http://www.cbr.ru/scripts/Root.asp) отправлять запросы для получения данных с их серверов. Они это называют веб-сервис, их несколько:

- Получение данных, используя XML
- Веб-сервис для получения ежедневных данных
- Веб-сервис для регионального раздела
- Веб-сервис получения информации справочника по кредитным организациям
- Веб-сервис получения информации по рынку ценных бумаг
- Веб-сервис для поисковой системы

Пакет cbr позволяет работать c [получением данных, используя XML](http://www.cbr.ru/scripts/Root.asp?PrtId=SXML) и с веб-сервисом получения информации по [рынку ценных бумаг](http://www.cbr.ru/secinfo/secinfo.asmx).

Подключаем пакет:
```{r}
library("cbr")
```



## Получение данных, используя XML

Рассмотрим, какие функции есть:

-  получения котировок на заданный день `cbr_cur_ondate(ondate = )`

```{r}
# котировки на 14 июня 2016 года
currency <- cbr_cur_ondate(ondate = "2016-06-14")
head(currency)
```

Здесь необходимо отметить, что в список попадают все котировки, которые на заданную дату выставлены (может быть так, что в один день котировка на бурундийский франк есть, а в другой - нет).

-  получения динамики котировок `cbr_currency(currency = , from = , to = )`

```{r}
# динамика котировки бурундийского франка (R01120) за указанный период
currency <- cbr_currency(currency = "R01120", from = "1993-01-05", to = "2013-09-18")
head(currency)
```

- получения динамики сведений об остатках средств на корреспондентских счетах кредитных организаций `cbr_balances(from = , to = )`

```{r}
# динамика сведений за указанный период
balances <- cbr_balances(from = "2007-01-01", to = "2013-01-01")
head(balances)
```

- получения динамики котировок драгоценных металлов `cbr_metal(from = , to = )`
- получения динамики ставок межбанковского рынка `cbr_credit_rates(from = , to = )`
- получения динамики ставок "валютный своп" `cbr_swap(from = , to = )`
- получения динамики отпускных цен Банка России на инвестиционные монеты `cbr_coins(from = , to = )`

## Веб-сервис получения информации по рынку ценных бумаг

Посмотрим на вспомогательный датафрейм, в котором содержится информация о всех переменных рынка ценных бумаг с которыми работает пакет `cbr`:
```{r echo=FALSE}
data("cbr_requests")
cbr_requests
```


Давайте посмотрим на данные сессии прямого РЕПО по фиксированной ставке (RepoSessionXML):
```{r}
repo <- cbr_security_info("RepoSessionXML")
head(repo)
```

Как можно заметить, данные в очень сыром виде, поэтому необходимо произвести несколько манипуляций, чтобы они были презентабельные, для этого заходим в соответствующий [раздел](http://www.cbr.ru/scripts/SecInfo_XSD/RepoSession.xsd) и смотрим, что обозначают переменные

```{r}
# сделаем дату в нормальном формате
repo[, "D0"] <- as.Date(as.POSIXct(repo[, "D0"])) + 1
# оставим один знак после запятой
repo[, 2:length(names(repo))] <- apply(repo[, 2:length(names(df))], 1, as.numeric)
# обновим названия переменных
names(repo) <- c("Date", "1dayRate", "1dayVolume", "1weekRate", "1weekVolume")
head(repo)
```




